"use strict";var l=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var C=(e,r)=>{for(var o in r)l(e,o,{get:r[o],enumerable:!0})},j=(e,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of b(r))!T.call(e,a)&&a!==o&&l(e,a,{get:()=>r[a],enumerable:!(s=Q(r,a))||s.enumerable});return e};var R=e=>j(l({},"__esModule",{value:!0}),e);var P={};C(P,{graphql:()=>O});module.exports=R(P);async function f(e){let r=e.headers.get("Content-Type")?.toLowerCase();if(r?.startsWith("application/json")||r?.startsWith("application/health+json")){let o=await e.json();if(!e.ok)throw o;return"data"in o?o.data:o}if(r?.startsWith("text/html")||r?.startsWith("text/plain")){let o=await e.text();if(!e.ok)throw o;return o}}var d=async(e,r,o=globalThis.fetch)=>{r.headers=typeof r.headers=="object"&&!Array.isArray(r.headers)?r.headers:{};let s=await o(e,r);return await f(s).catch(n=>{throw{errors:typeof n=="object"&&"errors"in n?n.errors:n,response:s}})};var H={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL};var x=e=>{let r={};if(Array.isArray(e.fields)&&e.fields.length>0){let o=(s,a=[])=>{if(typeof s=="object"){let n=[];for(let m in s){let c=s[m]??[];if(Array.isArray(c))for(let i of c)n.push(o(i,[...a,m]));else if(typeof c=="object")for(let i of Object.keys(c)){let S=c[i];for(let p of S)n.push(o(p,[...a,`${m}:${i}`]))}}return n.flatMap(m=>m)}return[...a,String(s)].join(".")};r.fields=e.fields.flatMap(s=>o(s)).join(",")}return e.filter&&Object.keys(e.filter).length>0&&(r.filter=JSON.stringify(e.filter)),e.search&&(r.search=e.search),"sort"in e&&e.sort&&(r.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(r.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(r.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(r.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(r.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(r.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(r.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(r.groupBy=e.groupBy.join(",")),r};var y="/",g=(e,r)=>(e.endsWith(y)&&(e=e.slice(0,-1)),r.startsWith(y)||(r=y+r),e+r),h=(e,r,o)=>{let s=e.pathname===y?r:g(e.pathname,r),a=new globalThis.URL(s,e);if(o)for(let[n,m]of Object.entries(x(o)))if(m&&typeof m=="object"&&!Array.isArray(m))for(let[c,i]of Object.entries(m))a.searchParams.set(`${n}[${c}]`,String(i));else a.searchParams.set(n,m);return a};var D={},O=(e={})=>r=>{let o={...D,...e};return{async query(s,a,n="items"){let m={method:"POST",body:JSON.stringify({query:s,variables:a})};"credentials"in o&&(m.credentials=o.credentials);let c={};if("getToken"in this){let p=await this.getToken();p&&(c.Authorization=`Bearer ${p}`)}"Content-Type"in c||(c["Content-Type"]="application/json"),m.headers=c;let i=n==="items"?"/graphql":"/graphql/system",S=h(r.url,i);return await d(S.toString(),m,r.globals.fetch)}}};0&&(module.exports={graphql});
//# sourceMappingURL=index.cjs.map